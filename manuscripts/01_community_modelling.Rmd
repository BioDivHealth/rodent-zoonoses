---
title: "Modelling Zoonoses in Rodent Communities"
author: "David Redding, Greg Milne, Ana Martinez-Checa, Harry Gordon"
date: "07/06/2024"
bibliography: 01_references.bib
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

This is the working manuscript for a study on disease modelling in rodent communities by the Infectious Disease Systems Ecology group at the British Natural History Museum.

David Simons' paper: @simons2023.

Paper on causal inference: @dee2023.

## Methods

These are the methods.

Here is a world map displaying locations of our sampled rodents:

```{r plot_world_map, echo=FALSE}
# Load necessary libraries
library(ggplot2)
library(maps)
library(mapdata)

# Load data frame
host_path <- readRDS("../data/host_path_wide.rds")
attach(host_path)
# Get the world map data
world <- map_data("world")

# Plot the points onto the world map 
ggplot() +
  geom_polygon(data = world, aes(x = long, y = lat, group = group), fill = "lightgray", color = "darkgray") +
  geom_point(data = host_path, aes(x = decimalLongitude, y = decimalLatitude), color = "red", size = 2) +
  theme_minimal() +
  coord_fixed(1.3) +
  theme(
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank())

```

Here is a timeline of the samples used in this analysis:

```{r plot_timeline, echo=FALSE, fig.height = 2}
# Load necessary libraries
library(ggplot2)

# plot the study dates on a timeline
ggplot(host_path, aes(x = start_date, y = 1)) +
  geom_segment(aes(x = start_date, xend = start_date, y = 0.9, yend = 1.1), color = "red") +
  geom_hline(yintercept = 1, linetype = "dashed") +
  scale_y_continuous(limits = c(0.5, 1.5)) +
  labs(title = "Timeline of Samples", x = "Date", y = "") +
  theme_minimal() +
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```

### Rodent phylogeny
Here is the mammal tree with our host species higlighted

```{r plot_phylogeny, echo=FALSE, message=FALSE, warning=FALSE}
# load necessary libraries
library(ggtree)
library(ggplot2)
library(here)

# load data
host.clade <- read.tree(here("data", "./phylogenetics/host.mrca.tree"))
pruned.host.spp <- readRDS(here("data", "./phylogenetics/harmonised.host.sp.names.rds")) %>%
  as.data.frame()

# find our species of interest
host.clade$in.data <- ifelse(host.clade$tip.label %in% pruned.host.spp$tree.names, 
       "purple", NA)
host.clade$in.data <- as.factor(host.clade$in.data)

# Plot the phylogeny
ggtree(host.clade, size = 0.05) + 
  geom_tippoint(color = host.clade$in.data, size = 3) + 
  geom_treescale(x = 0, y = 2200, col = "midnightblue")

```

### GLC database
Here is an example of a raster from the GLC database, the X and Y are Longitude and Latitude respectively.

```{r plot_raster, echo=FALSE, message=FALSE, warning=FALSE}
# Load necessary libraries
library(raster)
library(tiff)

str_name <-'../data/example_raster/19852000_E15N45.tif' 
raster_stack <- stack(str_name)

croat_1990 <- raster_stack[[2]]

plot(croat_1990, main="Land cover for Croatia in 1990")
```

## Results

These are the results.

## Discussion

This is the discussion.

## References